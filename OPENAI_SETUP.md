# OpenAI API Integration Setup Guide

## Overview

Your TeachLeague app now supports both Google Gemini and OpenAI APIs for curriculum generation, with automatic fallback when rate limits are reached.

## Features Implemented

- **Multi-provider support**: Choose between Gemini and OpenAI
- **Automatic fallback**: If one provider hits rate limits, automatically switches to the other
- **User toggle**: UI dropdown to select preferred AI provider
- **Smart retry**: Exponential backoff retry logic before switching providers
- **Visual feedback**: Alert notifications showing which provider is being used

## Setup Instructions

### 1. Add Your OpenAI API Key

Edit your `.env` file and replace the placeholder with your actual OpenAI API key:

```bash
REACT_APP_OPENAI_KEY=your_openai_api_key_here
```

To get an OpenAI API key:
1. Go to https://platform.openai.com/api-keys
2. Sign in or create an account
3. Click "Create new secret key"
4. Copy the key and paste it into your `.env` file

### 2. Configure Default Provider (Optional)

The default provider is set to Gemini. To change it to OpenAI:

```bash
REACT_APP_DEFAULT_AI_PROVIDER=openai  # Change from 'gemini' to 'openai'
```

### 3. Configure OpenAI Model (Optional)

By default, the app uses `gpt-4o-mini` (cost-effective). You can change to a different model:

```bash
REACT_APP_OPENAI_MODEL=gpt-4o         # For higher quality responses
# Other options: gpt-4o-mini, gpt-3.5-turbo
```

### 4. Restart Your Development Server

After updating the `.env` file:

```bash
npm start  # or npm run dev
```

## How It Works

### Provider Selection

Users can select their preferred AI provider from a dropdown in the curriculum generator:
- **Google Gemini**: Your current free-tier provider
- **OpenAI GPT**: Your new OpenAI-powered option

The selection is saved to localStorage and persists across sessions.

### Automatic Fallback

When rate limits are hit:
1. The system tries the selected provider up to 3 times with exponential backoff
2. If still failing due to rate limits, automatically switches to the alternate provider
3. User sees a notification: "Rate limit reached on GEMINI. Automatically switched to OpenAI."

### Rate Limit Detection

The system detects rate limits from:
- HTTP 429 status codes
- "rate limit" or "quota" error messages
- Provider-specific error patterns

## Files Modified

1. **`src/utils/aiProviderFactory.js`** (NEW)
   - Provider abstraction layer
   - Retry and fallback logic
   - Supports Gemini and OpenAI

2. **`src/utils/generateAIWarmUps.js`**
   - Refactored to use provider factory
   - Returns metadata about which provider was used

3. **`src/components/GenerateWarmUp.jsx`**
   - Added provider selection dropdown
   - Added feedback alerts for fallback events
   - Updated to handle new response format

4. **`.env`**
   - Added OpenAI configuration variables

5. **`package.json`**
   - Added `openai` package dependency

## Usage

### In the UI

1. Go to the Curriculum Generator page
2. Look for the "AI Provider" section near the top
3. Select your preferred provider from the dropdown
4. Generate your curriculum as normal

### Provider Feedback

After generation, you'll see one of these alerts:
- **Info (blue)**: "Generated by OpenAI" - Normal operation
- **Warning (yellow)**: "Rate limit reached on GEMINI. Automatically switched to OpenAI." - Fallback occurred
- **Danger (red)**: "Generation failed. [error message]" - Both providers failed

## Troubleshooting

### "OpenAI API key not found" Error

- Make sure you've added `REACT_APP_OPENAI_KEY` to your `.env` file
- Restart your development server after adding the key

### Provider Not Showing in Dropdown

- Check browser console for initialization errors
- Verify both API keys are valid
- Make sure environment variables start with `REACT_APP_`

### Both Providers Failing

- Check your internet connection
- Verify both API keys are valid and have available quota
- Check the console for detailed error messages

## Cost Considerations

### OpenAI Pricing (as of 2025)

- **gpt-4o-mini**: ~$0.15-0.60 per 1M tokens (input/output)
- **gpt-4o**: ~$5-15 per 1M tokens (input/output)
- **gpt-3.5-turbo**: ~$0.50-1.50 per 1M tokens (input/output)

A typical curriculum generation uses ~1,000-2,000 tokens, costing:
- **gpt-4o-mini**: $0.0003-0.0012 per generation
- **gpt-4o**: $0.01-0.03 per generation

### Gemini Free Tier

- 15 requests per minute
- 1,500 requests per day
- 1 million tokens per day

## YouTube Video Integration (NEW!)

The curriculum generator now automatically includes YouTube playlist links from your TeachLeague courses in the generated lesson plans!

### How It Works

When generating lesson plans:
1. The system identifies relevant TeachLeague courses for the topic
2. If those courses have YouTube playlists attached (`youtube`, `extrayoutube`, `extrayoutube1` fields)
3. The AI will include those playlist links in appropriate sections:
   - **Introduction/Hook**: Videos to capture interest
   - **Direct Instruction**: Videos explaining concepts
   - **Independent Practice**: Videos for student self-learning
   - **Related Courses**: Comprehensive video resources

### Example Output

```markdown
## Direct Instruction (15-20 minutes)
- Explain the key concepts of the Revolutionary War
- View videos from the [Philosophy YouTube Playlist](https://youtube.com/playlist?list=...)
- Discuss primary sources with students
```

### Benefits

- **Flipped classroom ready**: Videos for pre-class viewing
- **Differentiation**: Multiple learning modalities
- **Student engagement**: Multimedia resources
- **Save time**: Pre-curated video content from your courses

## Future Enhancements

Potential improvements for the future:
- Add usage tracking and cost estimation
- Implement request queuing to stay within rate limits
- Add support for more providers (Anthropic Claude, Groq, etc.)
- Provider-specific prompt optimization
- A/B testing between providers
- Individual video selection (not just playlists)

## Support

If you encounter any issues:
1. Check the browser console for detailed error messages
2. Verify your API keys are correct
3. Check that environment variables are properly set
4. Ensure the development server was restarted after `.env` changes
